@use "sass:map";
@use "../variables" as v;
@use "../functions" as fn;
@use "../mixins" as mixins;

$default-variables: (
        layout: v.$layout,
        misc: v.$misc,
        text-colors: (
                light: v.$black,
                disabled-light: v.$black,
                dark: v.$white,
                disabled-dark: v.$white
        )
);

@function generate-theme($theme-options: null) {
  $defaults: (
          scale-light: v.$light-mode,
          scale-dark: v.$dark-mode,
          theme-name: "nuitral",
          light-class: "nuitral-light-mode",
          dark-class: "nuitral-dark-mode",
          variables: $default-variables,
  );

  @return map.deep-merge($defaults, $theme-options);
}

@mixin apply-theme($theme-map) {
  $theme-name: map.get($theme-map, theme-name);
  $light-class: map.get($theme-map, light-class);
  $dark-class: map.get($theme-map, dark-class);
  $light-scale: map.get($theme-map, scale-light);
  $dark-scale: map.get($theme-map, scale-dark);
  $variables: map.get($theme-map, variables);

  //
  // LIGHT MODE
  //
  [nuitral-theme="#{$theme-name}"].#{$light-class} {


    --text-color: #{fn.get-token($variables, text-colors, light)};

    --box-shadow: #{v.$box-shadow};
    --box-shadow-focus: #{v.$box-shadow-focus};

    @include mixins.generate-misc-css-variables($variables);
    @include mixins.generate-css-colors-variables($light-scale);
    @include mixins.generate-text-and-state-variables(
                    $light-scale,
                    map.get($theme-map, light-text-color),
                    map.get($theme-map, dark-text-color)
    );
  }

  //
  // DARK MODE
  //
  [nuitral-theme="#{$theme-name}"].#{$dark-class} {
    --text-color: #{fn.get-token($variables, text-colors, dark)};
    --box-shadow: #{v.$box-shadow-dark};
    --box-shadow-focus: #{v.$box-shadow-dark-focus};

    @include mixins.generate-misc-css-variables($variables);
    @include mixins.generate-css-colors-variables($dark-scale);
    @include mixins.generate-text-and-state-variables(
                    $dark-scale,
                    map.get($theme-map, light-text-color),
                    map.get($theme-map, dark-text-color)
    );
  }

  //
  // COMPONENTS
  //

  // BOX
  @include mixins.generate-box(
                  fn.get-token($variables, misc, border-radius-molecules)
  );
  @include mixins.generate-box-background-classes($light-scale);

  @debug v.$height-atoms;
  // BUTTON
  @include mixins.generate-button(
                  v.$transitions-global,
                  v.$height-atoms,
                  fn.get-token($variables, misc)
  );
  @include mixins.generate-button-background-classes(
                  $light-scale,
                  var(--box-shadow),
                  var(--box-shadow-focus)
  );

  // CARD
  @include mixins.generate-card(
                  fn.get-token($variables, misc, border-radius-atoms)
  );
  @include mixins.generate-card-background-classes($light-scale);

  // INPUT
  @include mixins.generate-input(
                  v.$primary,
                  v.$background-400,
                  v.$background-700,
                  v.$background-700,
                  v.$transitions-global,
                  v.$height-atoms,
                  v.$border-radius-atoms
  );
  @include mixins.generate-input-classes();

  // TABS
  @include mixins.generate-tabs();

  // TAB
  @include mixins.generate-tab(v.$height-atoms, v.$transitions-global);
  @include mixins.generate-tab-classes($light-scale);

  // SPACING
  @include mixins.generate-spacing(v.$directions, v.$spacers);

  // LAYOUT
  @include mixins.generate-layout($variables);

  // TEXT COLORS
  @include mixins.generate-color-classes($light-scale);

  // BACKGROUND COLORS
  @include mixins.generate-background-classes(
                  $light-scale,
                  v.$transitions-global
  );
}
