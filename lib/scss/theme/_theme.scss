@use "sass:map";
@use "../variables" as var;
@use "../functions" as fn;
@use "../mixins" as mx;

$default-variables: (
        layout: var.$layout,
        misc: var.$misc,
        text-colors: (
                light: var.$black,
                disabled-light: var.$black,
                dark: var.$white,
                disabled-dark: var.$white
        )
);

@function generate-theme($theme-options: null) {
  $defaults: (
          scale-light: var.$light-mode,
          scale-dark: var.$dark-mode,
          theme-name: "nuitral",
          light-class: "nuitral-light-mode",
          dark-class: "nuitral-dark-mode",
          variables: $default-variables,
  );

  @return map.deep-merge($defaults, $theme-options);
}

@mixin apply-theme($theme-map) {
  $theme-name: map.get($theme-map, theme-name);
  $light-class: map.get($theme-map, light-class);
  $dark-class: map.get($theme-map, dark-class);
  $light-scale: map.get($theme-map, scale-light);
  $dark-scale: map.get($theme-map, scale-dark);
  $variables: map.get($theme-map, variables);

  //
  // LIGHT MODE
  //
  [nuitral-theme="#{$theme-name}"].#{$light-class} {
    --text-color: var(--text-color-light);
    --box-shadow: #{var.$box-shadow};
    --box-shadow-focus: #{var.$box-shadow-focus};

    @include mx.generate-misc-css-variables($variables);
    @include mx.generate-css-colors-variables($light-scale);
    @include mx.generate-text-and-state-variables(
                    $light-scale, $variables
    );
  }

  //
  // DARK MODE
  //
  [nuitral-theme="#{$theme-name}"].#{$dark-class} {
    --text-color: var(--text-color-dark);
    --box-shadow: #{var.$box-shadow-dark};
    --box-shadow-focus: #{var.$box-shadow-dark-focus};

    @include mx.generate-misc-css-variables($variables);
    @include mx.generate-css-colors-variables($dark-scale);
    @include mx.generate-text-and-state-variables(
                    $dark-scale, $variables
    );
  }

  //
  // COMPONENTS
  //

  // BOX
  @include mx.generate-box(
                  fn.get-token($variables, misc, border-radius-molecules)
  );
  @include mx.generate-box-background-classes($light-scale);

  // BUTTON
  @include mx.generate-button(
                  var.$transitions-global,
                  var.$height-atoms,
                  fn.get-token($variables, misc)
  );
  @include mx.generate-button-background-classes(
                  $light-scale,
                  var(--box-shadow),
                  var(--box-shadow-focus)
  );

  // CARD
  @include mx.generate-card(
                  fn.get-token($variables, misc, border-radius-atoms)
  );
  @include mx.generate-card-background-classes($light-scale);

  // INPUT
  @include mx.generate-input(
                  var.$primary,
                  var.$background-400,
                  var.$background-700,
                  var.$background-700,
                  var.$transitions-global,
                  var.$height-atoms,
                  var.$border-radius-atoms
  );
  @include mx.generate-input-classes();

  // TABS
  @include mx.generate-tabs();

  // TAB
  @include mx.generate-tab(var.$height-atoms, var.$transitions-global);
  @include mx.generate-tab-classes($light-scale);

  // SPACING
  @include mx.generate-spacing(var.$directions, var.$spacers);

  // LAYOUT
  @include mx.generate-layout($variables);

  // TEXT COLORS
  @include mx.generate-color-classes($light-scale);

  // BACKGROUND COLORS
  @include mx.generate-background-classes(
                  $light-scale,
                  var.$transitions-global
  );
}
